{% extends "base.html" %}
{% block title %}Configuraci贸n{% endblock %}
{% block content %}

<div class="container">
  <h2></h2>
  <ul class="nav nav-tabs">
    <li class="active"><a data-toggle="tab" href="#micuenta">Mi cuenta</a></li>
    <li><a data-toggle="tab" href="#loc">Localizaci贸n</a></li>
  </ul>

  <div class="tab-content">
    <div id="micuenta" class="tab-pane fade in active">
      <h3>Mi cuenta</h3>
      <p>
      	<form method="post">
      		{% csrf_token %}
      		</div>
      		    <div class="form-group">
      		      <label class="control-label col-sm-2" for="pwd">New password:</label>
      		      <div class="col-sm-10">
      			<input type="password" class="form-control" id="pwd1" placeholder="Enter password" name="pwd1">
      		      </div>
      		 </div>
      		</div>
      		    <div class="form-group">
      		      <label class="control-label col-sm-2" for="pwd">Repeat new password:</label>
      		      <div class="col-sm-10">
      			<input type="password" class="form-control" id="pwd2" placeholder="Enter password" name="pwd2">
      		      </div>
      		 </div>
      		<button type="submit">Cambiar</button>
      		{% csrf_token %}
      	</form>
      </p>
    </div>
    <div id="loc" class="tab-pane fade">
      <h3>Localizaci贸n de tienda mas pr贸xima</h3>
      <p>
        		<div id="map"></div>
        		<!--
        			Not using just standard Google Maps
        			<script src="http://maps.google.com/maps/api/js?sensor=true"></script>
        		-->
        		<!--
        			Now using Places library which also loads the Maps api
        			Reference: https://code.google.com/apis/maps/documentation/javascript/places.html
        		-->
            {% block head %}

            <script src="http://maps.googleapis.com/maps/api/js?libraries=places&sensor=true"></script>
        		<script type="text/javascript">
        			// Set-up new map instance (no location details specified yet)
        			var map = new google.maps.Map(document.getElementById('map'), {
        					mapTypeControl: true,
        					mapTypeControlOptions: {
        						style: google.maps.MapTypeControlStyle.DROPDOWN_MENU
        					},
        					mapTypeId: google.maps.MapTypeId.ROADMAP,
        					streetViewControl: true
        				}),
        				infowindow = new google.maps.InfoWindow(),
        				marker,
        				latlng,
        				watchID

        			/**
        			 * Following property indicates whether the current rendering engine is Trident (i.e. Internet Explorer)
        			 *
        			 * @return v { Integer|undefined } if IE then returns the version, otherwise returns 'undefined' to indicate NOT a IE browser
        			 */
        			var isIE = (function() {
        				var undef,
        					v = 3,
        					div = document.createElement('div'),
        					all = div.getElementsByTagName('i');

        				while (
        					div.innerHTML = '<!--[if gt IE ' + (++v) + ']><i></i><![endif]-->',
        					all[0]
        				);

        				return v > 4 ? v : undef;
        			}());

        			var whichPrefix = (function(){
        				// check if the browser supports CSS animation
        				var temp = document.createElement('div'),
        					prefixes = 'Webkit Moz O ms Khtml'.split(' '),
        					prefix = false;

        				for(var i = 0, len = prefixes.length; i < len; i++) {
        					if(temp.style[prefixes[i] + 'Transform'] !== undefined) {
        						prefix = prefixes[i];
        						break;
        					}
        				}

        				return prefix;
        			}());



        			function isHostObject(object, property) {
        				// object[property] protects against ES3 specification which allows null to be typeof 'object'
        				// so we check if 'object' is returned and that object[property] coerces to true
        				// then we group both checks (&& operator returns 2nd expression if 1st expression evaluates to true) and convert result into boolean
        				return !!(typeof(object[property]) == 'object' && object[property]);
        			}

        			function createMarker(place) {
        				var placeLoc = place.geometry.location,
        					marker = new google.maps.Marker({
        						map: map,
        						position: place.geometry.location,
        					}),
        					content = '<strong>' + place.name + '</strong><br>' + place.vicinity;

        				google.maps.event.addListener(marker, 'click', function() {
        					infowindow.setContent(content);
        					infowindow.open(map, this);
        				});
        			}

        			function processLocation(position) {
        				// Get position
        				var lat = position.coords.latitude,
        					lng = position.coords.longitude,
        					latlng = new google.maps.LatLng(lat, lng);

        				// Set map location
        				map.setOptions({
        		        	center: latlng,
        		        	scrollwheel: false,
        		        	zoom: 12
        		        });

        		        // Add marker to map
        		        marker = new google.maps.Marker({
        					position: latlng,
        					map: map,
        					title: 'Test Title'
        				});

        				// Event listener for users current location marker
        				google.maps.event.addListener(marker, 'click', function() {
        					infowindow.setContent('This is your current location!<br>We\'re now showing you all the Libraries in a 8 km radius');
        					infowindow.open(map, this);
        				});

        				// Open the window when the app has loaded
        				google.maps.event.trigger(marker, 'click', function() {
        					infowindow.setContent('This is your current location!<br>We\'re now showing you all the Libraries in a 8 km radius');
        					infowindow.open(map, this);
        				});

        				// Request any Comic's shop within 1 mile (in meters) from the current location
        				var request = {
        					location: latlng,
        					radius: 8000.00, // 5 miles => http://www.unitconversion.org/length/meters-to-miles-conversion.html
                  type:['book_store'],
                  name: 'Comics'
        				};

        				// Create the Places request
        				var service = new google.maps.places.PlacesService(map);
        					service.search(request, function(results, status){
        						if (status == google.maps.places.PlacesServiceStatus.OK) {
        							for (var i = 0; i < results.length; i++) {
        								var place = results[i];
        								createMarker(results[i]);
        							}
        						}
        					});
        			}

        			// Doesn't appear to be executed??
        			function handleLocationErrors(err) {
        				switch(err.code) {
        					case err.PERMISSION_DENIED:
        						alert('You have decided not to share your location information');
        						break;
        					case err.POSITION_UNAVAILABLE:
        						alert('I\'m sorry but we could not detect your location');
        						break;
        					case err.TIMEOUT:
        						alert('I\'m sorry but the system timed out while waiting to retrieve your location information');
        						break;
        					default:
        						alert('I\'m sorry but an unknown error occurred');
        						break;
        				}
        			}

        			// Because of IE9's rubbish implementation of geolocation makes it as useful as the basic ip address lookup polyfills (so not very useful)
        			if(isHostObject(navigator, 'geolocation') || isIE > 9) {
        				// This will ask the user to authorise the request for their location (only if geolocation is natively supported)
        				navigator.geolocation.getCurrentPosition(processLocation, handleLocationErrors);

        				// If the user starts moving around then watch their position
        				watchID = navigator.geolocation.watchPosition(function(){
        					// DO SOMETHING
        				});
        			} else {
        				alert('I\'m sorry, your device isn\'t capable of supporting the geolocation api which is required for this application to work correctly');
        			}
        		</script>
            {% endblock %}




      </p>
    </div>
  </div>
</div>
{% endblock %}
